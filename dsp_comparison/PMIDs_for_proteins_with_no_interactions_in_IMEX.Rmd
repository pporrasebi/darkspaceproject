---
title: "PMIDs for proteins which have no interactions in IMEx"
author: "Vitalii Kleshchevnikov"
date: "2 May 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# install packages if some are not already installed
# packages = c("plyr","dplyr","data.table","UpSetR", "splitstackshape", "ggplot2", "shiny", "VennDiagram")
# if(mean(packages %in% installed.packages()) != 1){
#        install.packages(packages[!packages %in% installed.packages()])
#}
suppressPackageStartupMessages({
library(data.table)
library(ggplot2)
library(VennDiagram)
library(UniProt.ws)
})
```

#### This script generates the list of the pubmed publication identifiers associated with proteins which have no interactions in any of the IMEx databases including DIP. IMEx dataset is generated by “IMEx dataset generator” pipeline from DSP. 

```{r load_IMEx}
imex_full <- fread("../IMEx/results/imex_full.txt", header=T, sep="\t",colClasses="character",data.table = T)
imex_human <- unique(subset(imex_full,taxid_a=="9606" & taxid_b=="9606"))
imex_human$imex <- 1
imex_human_proteins = unique(base::c(imex_human$id_a_clean,imex_human$id_b_clean))
```

#### Load gene to PMID dataset (NCBI)

```{r load_NCBI_gene_to_PMID}
geneID2pubmed_url = "ftp://ftp.ncbi.nih.gov/gene/DATA/gene2pubmed.gz"
geneID2pubmed_filename = paste0("./geneID2pubmed_release_", format(Sys.Date(), "%m-%Y.gz"))
geneID2pubmed_filename_txt = substr(geneID2pubmed_filename, 1, nchar(geneID2pubmed_filename)-3)
if(!file.exists(geneID2pubmed_filename)) {
  downloader::download(geneID2pubmed_url, geneID2pubmed_filename)
}
R.utils::gunzip(geneID2pubmed_filename, remove = F, overwrite = T)
# getting all pmids which have genes associated with them
geneID2pubmed = fread(geneID2pubmed_filename_txt, colClasses = c("character","character","character"))
geneID2pubmed_human = geneID2pubmed[`#tax_id` == "9606",]
unlink(geneID2pubmed_filename_txt)
```

#### Map Entrez gene ids to UniprotKB ids

```{r map_Uniprot_ID_2_Entrez}
uniprot = UniProt.ws()
# grep("PUB",columns(unp), value =T)
human_genes_with_PMIDs = unique(geneID2pubmed[,GeneID])
entrezgene2uniprot = data.table()
for(i in seq(1, length(human_genes_with_PMIDs), 2000)){
        entrezgene2uniprot_temp = as.data.table(select(uniprot, 
               keys = human_genes_with_PMIDs[i:(i+2000)], 
               columns = c("ENTREZ_GENE", "UNIPROTKB"),
               keytype = "ENTREZ_GENE"))
        entrezgene2uniprot = rbind(entrezgene2uniprot, copy(entrezgene2uniprot_temp[complete.cases(entrezgene2uniprot_temp),]))
}
entrezgene2uniprot_not_in_imex = unique(entrezgene2uniprot[!UNIPROTKB %in% imex_human_proteins,])
```

#### `r entrezgene2uniprot[, length(unique(UNIPROTKB))]` proteins (UNIPROTKB) have been mapped to genes.  
#### `r entrezgene2uniprot[!UNIPROTKB %in% imex_human_proteins, length(unique(UNIPROTKB))]` proteins (UNIPROTKB) mapped to genes do not have interactions in IMEx.  
#### `r entrezgene2uniprot[UNIPROTKB %in% imex_human_proteins, length(unique(UNIPROTKB))]` proteins (UNIPROTKB) mapped to genes do have interactions in IMEx.  

```{r save_pmids_with_proteins_witout_interactions}
NCBI_pmids = geneID2pubmed_human[GeneID %in% entrezgene2uniprot_not_in_imex$ENTREZ_GENE, unique(PubMed_ID)]
fwrite(NCBI_pmids, "./results/NCBI_pmids_with_proteins_witout_interactions.txt")
```


#### the list of pmids with proteins witout interactions is accessible: https://github.com/vitkl/darkspaceproject/tree/master/dsp_comparison/results/NCBI_pmids_with_proteins_witout_interactions.txt

#### Download protein to pmids mapping from UniProt

```{r protein_to_pmids_UniProt, eval =FALSE}
if(!file.exists("./source_files/protein_to_pmids_UniProt.txt")){
        downloader::download("http://www.uniprot.org/uniprot/?compress=no&query=organism:9606&fil=&force=no&format=tab&columns=id,citation,citationmapping", "./source_files/protein_to_pmids_UniProt.txt")
        R.utils::gzip("./source_files/protein_to_pmids_UniProt.txt")
}
R.utils::gunzip
protein_to_pmids_UniProt = fread("./source_files/protein_to_pmids_UniProt.txt", stringsAsFactors = F)
```