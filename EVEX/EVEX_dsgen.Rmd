---
output: 
  html_document: 
    keep_md: yes
---
EVEX dataset generator
========================================================

#### Load EVEX data

```{r echo=FALSE}
EVEX_date <- date()
suppressPackageStartupMessages({
        library(data.table)
        library(VennDiagram)
        library(downloader)
        library(R.utils)
        library(XML)
        })
```

I download the latest version of the EVEX data from EVEX website: relations table and articles table (which have common General event ID). Current file was downloaded on `r EVEX_date`. 

Format rescription:

```{r message=FALSE, warning=FALSE}
README = readLines("http://evexdb.org/download/network-format/README-network.txt")
README[19:35]
README[39:45]
```

```{r scrape_and_download_EVEX, message=FALSE, warning=FALSE}
url_EVEX = "http://evexdb.org/download/network-format/"
directories = htmlTreeParse(url_EVEX, useInternalNodes = T)
directories = xpathSApply(directories, "//a", xmlValue)
directories = grep("^[[:alpha:]]+/", directories , value = T)
filepaths = character()
files = character()
for(directory in directories) {
        files_temp = htmlTreeParse(paste0(url_EVEX, directory), useInternalNodes = T)
        files_temp = xpathSApply(files_temp, "//a", xmlValue)
        files_temp = grep("\\.tar\\.gz$", files_temp , value = T)
        files = c(files, files_temp)
        filepaths_temp = paste0(url_EVEX, directory,files_temp)
        filepaths = c(filepaths, filepaths_temp)
}
files = paste0("./source_files/", files)
for(i in 1:length(filepaths)){
       if(!file.exists(files[i])) download(filepaths[i],files[i])
}

```

```{r message=FALSE, warning=FALSE}
homo_file = grep("Homo", files, value =T)
gunzip(homo_file, remove = F)
untar(substr(homo_file, 1, nchar(homo_file)-3), exdir = "./source_files/Homo/")
unlink(substr(homo_file, 1, nchar(homo_file)-3))
Homo_sapiens_EVEX_relations = fread("./source_files/Homo/EVEX_relations_9606.tab")
Homo_sapiens_EVEX_articles = fread("./source_files/Homo/EVEX_articles_9606.tab")
```

EVEX is a text-mining resource which aims to identify interactions of different types from the literature as well as characterize those interactions and measure the confidence of those interactions being true (not an artifact of text-mining). Interactions is identified by a pair of genes (in the network format, there is another data format in EVEX which is not relevant here), characterized by type and polarity, and given a confidence score.

Below you can see how many interactions belong to each type. 

```{r types_of_interactions}
Homo_sapiens_EVEX_relations[,table(coarse_type)]
Homo_sapiens_EVEX_relations[,table(refined_type,refined_polarity)]
```

I need to filter only BioGRID interactions and to clean up the BioGRID file.

```{r message=FALSE, warning=FALSE}
mentha = fread("./source_files/2017-02-27_MITAB-2.5", header = F, sep = "\t", colClasses = "character")
biogrid_from_mentha = mentha[V13 == "psi-mi:\"MI:0463\"(biogrid)",]
fwrite(x = biogrid_from_mentha, file = "./processed_files/biogrid_mitab25.txt",sep = "\t")
system("perl ./scripts/MITAB25extractor_v12.pl ./processed_files/biogrid_mitab25.txt ./processed_files/biogrid_pairs.txt")
unlink(c("./source_files/2017-02-27_MITAB-2.5","./processed_files/biogrid_mitab25.txt"))
```

I save a table of interacting pairs, publication IDs and BioGRID tag.

```{r pairs, message=FALSE, warning=FALSE}
biogrid_from_mentha = fread("./processed_files/biogrid_pairs.txt", header = T, sep = "\t", colClasses = "character")
fwrite(x = unique(biogrid_from_mentha[, .(pair_id_clean, pubid, biogrid = rep(1, .N))]), 
       file = "./results/pairs_pmids_biogrid.txt", sep = "\t")
N_biogrid = length(biogrid_from_mentha[,unique(pair_id_clean)])
```

The BioGRID dataset contains `r N_biogrid` interacting pairs. 

I create a list of PMIDs that have been curated by them.

```{r pmids}
biogrid_pmids <- data.frame(unique(biogrid_from_mentha$pubid))

write.table(biogrid_pmids, "./results/biogrid_pmids.txt", quote=F, sep ="\t", row.names = F, col.names = T)
```

`r nrow(biogrid_pmids)` publications are curated into BioGRID database. 

#### Compare BioGRID interactions and publications to IMEx 

I calculate how many interactions in BioGRID match to IMEx.

```{r biogrid_vs_imex, message=FALSE, warning=FALSE, fig.width=4, fig.height=2}
imex = fread("https://raw.githubusercontent.com/pporrasebi/darkspaceproject/master/IMEx/results/imex_full.txt", header = T, sep = "\t", colClasses = "character")
N_imex = length(imex[,unique(pair_id_clean)])
N_biogrid = length(biogrid_from_mentha[,unique(pair_id_clean)])
N_overlap = sum(!is.na(match(biogrid_from_mentha[,unique(pair_id_clean)], imex[,unique(pair_id_clean)])))

venn.d = draw.pairwise.venn(area1 = N_imex, area2 = N_biogrid, cross.area = N_overlap, category = c("IMEx", "BioGRID"), 
                          lty = rep("blank", 2), 
                          fill = c("blue", "red"), 
                          alpha = rep(0.5, 2), cat.pos = c(0, 135), 
                          cat.dist = rep(0.035, 2), 
                          cat.cex = c(1,1), scaled = TRUE, euler.d = TRUE,  margin = 0.05,
                          direct.area = TRUE,
                          cex = 1)

```

I calculate how many publications in BioGRID match to IMEx.

```{r biogrid_vs_imex_pub, message=FALSE, warning=FALSE, fig.width=4, fig.height=2}
N_pubid_imex = length(imex[,unique(pubid)])
N_pubid_biogrid = length(biogrid_from_mentha[,unique(pubid)])
N_pubid_overlap = sum(!is.na(match(biogrid_from_mentha[,unique(pubid)], imex[,unique(pubid)])))

venn.d = draw.pairwise.venn(area1 = N_pubid_imex, area2 = N_pubid_biogrid, cross.area = N_pubid_overlap, category = c("IMEx", "BioGRID"), 
                          lty = rep("blank", 2), 
                          fill = c("blue", "red"), 
                          alpha = rep(0.5, 2), cat.pos = c(0, 135), 
                          cat.dist = rep(0.035, 2), 
                          cat.cex = c(1,1), scaled = TRUE, euler.d = TRUE,  margin = 0.05,
                          direct.area = TRUE,
                          cex = 1)

```

I calculate how many interactions published in specific articles (the same interaction can come from different publications) in BioGRID match to IMEx.

```{r biogrid_vs_imex_pub_inter, message=FALSE, warning=FALSE, fig.width=4, fig.height=2}
N_pub_int_imex = length(imex[,unique(paste0(pubid,"_",pair_id_clean))])
N_pub_int_biogrid = length(biogrid_from_mentha[,unique(paste0(pubid,"_",pair_id_clean))])
N_pub_int_overlap = sum(!is.na(match(biogrid_from_mentha[,unique(paste0(pubid,"_",pair_id_clean))], imex[,unique(paste0(pubid,"_",pair_id_clean))])))

venn.d = draw.pairwise.venn(area1 = N_pub_int_imex, area2 = N_pub_int_biogrid, cross.area = N_pub_int_overlap, category = c("IMEx", "BioGRID"), 
                          lty = rep("blank", 2), 
                          fill = c("blue", "red"), 
                          alpha = rep(0.5, 2), cat.pos = c(0, 135), 
                          cat.dist = rep(0.035, 2), 
                          cat.cex = c(1,1), scaled = TRUE, euler.d = TRUE,  margin = 0.05,
                          direct.area = TRUE,
                          cex = 1)

```